<!DOCTYPE html>
<html>
<head>
<title>SMJ Tournament - Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

<style>
body{background:#0d0d0d;color:white;font-family:sans-serif;margin:0}
.card{background:#1c1c1c;margin:10px;padding:15px;border-radius:12px}
button{background:#ff0000;color:white;border:none;padding:10px;border-radius:8px;width:100%}
input{width:100%;padding:8px;margin:5px 0;border-radius:6px;border:none}
h2,h3{text-align:center}
</style>
</head>
<body>

<div id="loginPage" class="card">
<h2>SMJ Tournament</h2>
<button onclick="googleLogin()">Login With Gmail</button>
</div>

<div id="app" style="display:none">

<div class="card">
<h3>Wallet</h3>
Balance: ৳<span id="balance">0</span><br>
Total Win: ৳<span id="totalWin">0</span>
</div>

<div class="card">
<h3>Deposit</h3>
<input id="depositAmount" type="number" placeholder="Amount">
<button onclick="deposit()">Request Deposit</button>
</div>

<div class="card">
<h3>Withdraw</h3>
<input id="withdrawAmount" type="number" placeholder="Amount">
<button onclick="withdraw()">Request Withdraw</button>
</div>

<div class="card">
<h3>Available Matches</h3>
<div id="matchList"></div>
</div>

<div class="card">
<h3>My Joined Matches</h3>
<div id="myMatches"></div>
</div>

</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDwbSpjV9g57XGx3J3neEO2EWO6C71AZeM",
  authDomain: "smj-tournament-32076.firebaseapp.com",
  projectId: "smj-tournament-32076",
  storageBucket: "smj-tournament-32076.firebasestorage.app",
  messagingSenderId: "725484165155",
  appId: "1:378261475305:web:954afd030f7617ca8e0578"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

function googleLogin(){
const provider=new firebase.auth.GoogleAuthProvider();
auth.signInWithPopup(provider);
}

auth.onAuthStateChanged(user=>{
if(user){
loginPage.style.display="none";
app.style.display="block";

const userRef=db.collection("users").doc(user.uid);

userRef.get().then(doc=>{
if(!doc.exists){
userRef.set({
name:user.displayName,
email:user.email,
balance:0,
totalWin:0
});
}
});

userRef.onSnapshot(doc=>{
balance.innerText=doc.data().balance;
totalWin.innerText=doc.data().totalWin;
});

loadMatches();
loadMyMatches();
}
});

function deposit(){
const amt=parseInt(depositAmount.value);
db.collection("depositRequests").add({
uid:auth.currentUser.uid,
amount:amt,
status:"pending"
});
alert("Deposit Request Sent");
}

function withdraw(){
const amt=parseInt(withdrawAmount.value);
db.collection("withdrawRequests").add({
uid:auth.currentUser.uid,
amount:amt,
status:"pending"
});
alert("Withdraw Request Sent");
}

function loadMatches(){
db.collection("matches").onSnapshot(snapshot=>{
let html="";
snapshot.forEach(doc=>{
const m=doc.data();
const now=new Date().getTime();
const start=new Date(m.startTime).getTime();
let status="Upcoming";
if(now>=start) status="Live";

html+=`
<div class="card">
<h4>${m.name}</h4>
Entry: ৳${m.entryFee}<br>
Prize: ৳${m.prize}<br>
Status: ${status}<br>
${status=="Live" && m.roomId ? 
"Room ID: "+m.roomId+"<br>Password: "+m.password : ""}
<button onclick="joinMatch('${doc.id}',${m.entryFee})">Join</button>
</div>
`;
});
matchList.innerHTML=html;
});
}

function joinMatch(id,fee){
const userRef=db.collection("users").doc(auth.currentUser.uid);

userRef.get().then(doc=>{
if(doc.data().balance>=fee){
userRef.update({balance:doc.data().balance-fee});
db.collection("participants").add({
matchId:id,
uid:auth.currentUser.uid
});
alert("Joined Successfully");
}else{
alert("Not Enough Balance");
}
});
}

function loadMyMatches(){
db.collection("participants")
.where("uid","==",auth.currentUser.uid)
.onSnapshot(snapshot=>{
let html="";
snapshot.forEach(doc=>{
html+="<div class='card'>Joined Match ID: "+doc.data().matchId+"</div>";
});
myMatches.innerHTML=html;
});
}</script>

<button onclick="googleLogin()">Login with Google</button>

</body>
</html>
</script>
</body>
</html>
